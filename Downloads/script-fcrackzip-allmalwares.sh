#!/bin/bash

# Fonction pour tester tous les fichiers .zip dans un répertoire
test_zip_files_in_directory() {
    # Récupère le répertoire spécifié
    directory=$1
    # Longueur du mot de passe par défaut
    length=4

    # Vérifie si le répertoire existe
    if [[ ! -d "$directory" ]]; then
        echo "Erreur : Le répertoire '$directory' n'existe pas."
        exit 1
    fi

    # Parcourt tous les fichiers .zip dans le répertoire
    for zip_file in "$directory"/*.zip; do
        # Vérifie si le fichier existe
        if [[ -f "$zip_file" ]]; then
            echo "Tentative d'extraction de $zip_file..."

            # Essaye d'extraire le fichier en utilisant un mot de passe de 4 chiffres
            for i in $(seq -f "%04g" 0 9999); do
                echo "Essai avec le mot de passe: $i"

                # Teste le mot de passe avec unzip
                unzip -P "$i" "$zip_file" -d "$directory/malwares-unzipped" &>/dev/null

                # Vérifie si l'extraction a réussi
                if [[ $? -eq 0 ]]; then
                    echo "Mot de passe trouvé pour $zip_file : $i"
                    echo "Extraction réussie pour $zip_file avec le mot de passe : $i"
                    break
                fi
            done
            echo "--------"
        fi
    done
}

# Demande à l'utilisateur d'entrer le répertoire
read -p "Entrez le répertoire où se trouvent les fichiers ZIP: " directory

# Appelle la fonction pour tester les fichiers ZIP dans le répertoire
test_zip_files_in_directory "$directory"
